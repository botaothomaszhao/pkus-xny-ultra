# PKUS XNY Ultra — VV (Version for Via)

> ### 北大附中新能源课程系统增强脚本, Via 浏览器适配版

---

[![License: GPL v3](https://img.shields.io/badge/License-GPLv3-blue.svg)](https://www.gnu.org/licenses/gpl-3.0)
[![GitHub last commit](https://img.shields.io/github/last-commit/c-jeremy/pkus-xny-ultra)](https://github.com/botaothomaszhao/pkus-xny-ultra/commits/main)
[![Tampermonkey](https://img.shields.io/badge/Tampermonkey-compatible-green)](https://www.tampermonkey.net/)
[![Via Browser Compatible](https://img.shields.io/badge/Via-Compatible-blue)](https://viayoo.com/)

## 重要声明

- Fork 自 [c-jeremy/PKUS XNY Ultra](https://github.com/c-jeremy/pkus-xny-ultra)，继续遵循 GPLv3 许可。
- 本项目用于适配 Via 浏览器，同时保持对 Edge 的兼容，欢迎反馈和贡献。
- VV版本脚本位于 `vv/` 目录下，`v1/` 和`v2/`目录为原版脚本，详见 [README-original-zh-CN.md](/README-original-zh-CN.md)。

## 功能和特点

每项功能均为独立脚本，可根据需要选择安装或在脚本管理页面选择是否开启。

脚本基于v1已有功能或v2功能拆分，也开发了更多功能，经测试在Via和安装篡改猴插件的Edge浏览器上可用。

- 主要功能：路径收藏夹、目录搜索、强制下载pdf、硬刷新、移除界面无用元素、自动收起侧边栏......仍在扩充
- 脚本改进、优点：
    - 完全兼容Via、Edge和Edge安卓版，并做了针对性适配
    - 可自行选择是否要更改ui风格
    - 可自行选择想要使用的脚本
    - 按钮位于左侧边栏，自然融入页面，完全不遮挡内容，且只需要点一下
    - 完善可用的路径自动重放功能
    - 支持选择相机拍照上传
    - ...
    - 更多具体功能详见脚本列表
- Via优点：
    - 极简风、极小空间占用
    - 支持固定工具栏/点击隐藏工具栏，不会上下滑动（注：展开任务栏那个按钮可以拖动）
    - 原生支持脚本，无需安装插件
    - 主页、菜单、长按菜单等均可定制
    - 支持工具栏色彩模式：让浏览器工具栏和系统任务栏跟随网页颜色
- 不足：
    - 多个功能的脚本需要分别安装（太大单一文件不容易排查兼容性问题）
    - 代码越来越臃肿（都是ai干的）
    - 见todo list吧...

## 脚本列表

| 文件名                          | 名称      | 描述                                 | 适用浏览器                | 备注                                                                  |
|------------------------------|---------|------------------------------------|----------------------|---------------------------------------------------------------------|
| `seamless-login.user.js`     | 成绩显示修复  | 无感登录保活。确保成绩显示、自阅等功能总是可用。           | 必装                   |                                                                     |
| `show-PDF-buttons.user.js`   | PDF操作栏  | 让预览PDF组件显示通常被隐藏的下载等按钮。             | 通用                   | 注意word ppt等也只能下载新能源转换后的pdf文件。开启则表示你愿意为所有下载行为负责，并且已经解除了开发者对你下载行为的责任。 | 
| `navigation-buttons.user.js` | 快捷导航按钮  | 提供收藏夹、目录搜索、页面刷新按钮，并在页面加载时自动重放路径。   | 通用                   | 刷新键单击重载页面，长按退出登录。                                                   |
| `del-unused.user.js`         | 删除无用元素  | 自动删除无用页面元素。                        | 通用                   | 包括头部“学科素养”、“考试用时”、“扫码上传”和未提交时的空图片框。                                 |
| `responsive-sidebar.user.js` | 自动收起侧边栏 | 在屏幕宽度改变时自动收起/展开侧边栏，并可通过点击左侧导航菜单展开。 | 通用                   |                                                                     |
| `image-selector.user.js`     | 图片选择框   | 上传照片时选择拍照上传或相册上传，拍照唤起系统相机。         | 通用                   | 完成拍照后可使用新能源自带旋转、裁剪工具。                                               |
| `build-in-camera.user.js`    | 网页内置相机  | 在网页内实现相机拍照，解决浏览器无法唤起相机的问题。         | Via等不支持capture字段的浏览器 | 与图片选择框脚本配合会作为“拍照上传”选项，单独使用会对全部图片上传元素生效。                             |
| `handwriting-fix.user.js`    | 手写滑动修复  | 修复手写输入时窗口上下滑动问题。                   | Edge安卓版              |                                                                     |
| `ui-black-and-white.user.js` | 纯黑白模式   | 将网页改为极简的暗黑风格                       | 通用                   |                                                                     |

图片上传说明：

- `image-selector.user.js` 和 `build-in-camera.user.js` 均可单独使用，并会对所有图片上传元素生效。
- 推荐Via用户同时安装两个脚本以获得最佳体验，此时“拍照上传”选项会使用内置相机拍照。
- 推荐Edge安卓版用户仅安装 `image-selector.user.js` 脚本，因为系统相机通常支持对焦等功能且画质更好。
- 如果不清楚浏览器是否支持唤起系统相机，判断方法：先安装 `image-selector.user.js` 脚本，点击“拍照作答”后选择“拍照上传”。
    - 如果能成功唤起系统相机则说明支持，可直接使用；
    - 如果打开的是和“相册上传”一样的图片选择界面则说明不支持，此时建议安装 `build-in-camera.user.js` 脚本。

## 如何安装

- Via
    1. 下载并安装Via浏览器：https://viayoo.com/
    2.
        - 打开Via浏览器，访问项目页面，找到需要的脚本文件（`*.user.js`），点击脚本文件中的"Raw"按钮，Via会自动接管安装过程，确认即可完成安装。
        - 或 打开需要的脚本页面并复制脚本内容，在Via浏览器设置 -> 脚本 中点击右上角加号选择"添加脚本"，将脚本粘贴进去并确认。
        - 或 下载需要的脚本文件，在Via的脚本管理页面中点击右上角加号选择"导入脚本"，找到下载的文件导入并确认。
    3. 安装完成后，在Via的脚本管理页面中查看和管理已安装的脚本。
- Edge
    - 见 [README-original-zh-CN.md#如何安装](/README-original-zh-CN.md#如何安装)
    - 安卓版不需要安装 `build-in-camera.user.js` 脚本，但推荐安装 `handwriting-fix.user.js` 脚本以修复窗口上下滑动问题。

## 贡献与反馈

- 本分支在原作者基础上做出适配修改，如有建议或发现问题，欢迎在仓库 Issues 中反馈或提交 PR。
- 若引用本代码或二次发布，请遵循 GPLv3 许可证条款并保留原作者署名与许可证信息。
- 感谢AI工具及提供商，尤其是免费为我提供Copilot教育许可的GitHub，这些工具为我编写陌生语言的代码提供了极大帮助（和添乱）。
- 再次感谢 c-jeremy 及所有开源贡献者！

## todos:

- [x] 测试改用ImageCapture
    - [x] 添加闪光灯功能
    - [ ] 是否需要缩放功能？
- [x] 修复按钮在edge中不固定、可能遮挡导航菜单
- [x] 修复edge中元素不正确跟随页面
- [x] 修复AI页顶部按钮栏位置不正确
- [x] 仅打开科目也保存路径
- [x] 干掉“扫一扫传答案”
- [x] 解决ItemDrawer focus和高光不一致
- [x] 修复分数栏可能被顶部top元素遮挡 - 不动xny史山了，回滚到改position完事
- [x] 修复搜索显示的路径不完整
- [x] 修复收起文件夹后保存路径不正确
- [x] 简化top栏文字
- [ ] 修复展开/收起答案后屏幕内容位置跳动
- [x] 修复强制刷新按钮乱转
- [x] 修复刷新后自动回放不正确
- [x] 解决关闭科目后不全部收起目录导致路径重放错误
- [ ] 从v2移植强制显示答案功能

- 计划中：
- [ ] 测试能否保存页面上方标签栏（未成功）
- [ ] 添加快捷键功能（希望获得反馈：用哪些键）
- [ ] 相机添加禁用增强选项（从v2获取实现代码）
- [ ] pdf预览框等添加和查看答案一样的全屏键
- [ ] 搜索支持先搜科目然后自动打开
- [ ] 支持搜索收藏夹（有需要吗？）
- [ ] 清理控制台输出

- 远期：
- [ ] 上方页面导航栏从只能用两侧按键移动改为可滑动：感觉有点难度
- [ ] 修复提交照片后只显示第一张预览（估计比较困难，仅作为可能改进方向）
- [ ] ...
