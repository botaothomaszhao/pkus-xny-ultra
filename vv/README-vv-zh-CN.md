# PKUS XNY Ultra — VV（Via 浏览器适配）版本

本说明为“VV（Version Via）”分支/发行版的说明文档。VV 版本在原作者 c-jeremy 的开源项目基础上进行适配与修改，以便在 Via 浏览器环境下获得更好的兼容性与体验。

# 重要声明与致谢
- 本项目基于 c-jeremy 的开源项目 [PKUS XNY Ultra](https://github.com/c-jeremy/pkus-xny-ultra)（感谢原作者与社区贡献）。我（fork 并修改后）在此基础上继续开源发布，欢迎大家审阅与改进。
- 许可证：与原项目一致（详见仓库 LICENSE，GPLv3）。

# 功能和特点
（目前）每项功能均为独立脚本，可根据需要选择安装或在脚本管理页面选择是否开启。脚本均基于v1已有功能/v2功能拆分，经测试在Via和安装篡改猴插件的Edge浏览器上可用。

- 主要功能：路径收藏夹、目录搜索、强制下载pdf、硬刷新、移除界面无用元素、自动收起侧边栏......仍在扩充
- Via优点：
  - 极简风、极小空间占用
  - 支持固定工具栏/点击隐藏工具栏，不上下滑动（注：展开任务栏那个按钮可以拖动）
  - 原生支持脚本，无需安装插件
  - 主页、菜单、长按菜单等均可定制
  - 支持工具栏色彩模式：让浏览器工具栏和系统任务栏跟随网页颜色
- 相比原版（主要对比v2）改进：
  - 兼容Via（废话）
  - 可自行选择是否要更改ui风格
  - 按钮只需要点一次
- 不足：
  - 目前未解决上传照片无法选择直接拍照的问题 
  - 多个功能的脚本需要分别安装（太大单一文件不容易排查兼容性问题）
  - 见todo list吧...


黑白UI修改无兼容性问题且未计划进行修改，可直接使用v1中`ui.user.js`，不再单独提供。

# 脚本列表

| 文件名                          | 描述                                                                     | 注意                                                 |
|------------------------------|------------------------------------------------------------------------|----------------------------------------------------|
| `seamless-login.user.js`     | 无感登录保活。确保成绩显示、自阅等功能总是可用。                                               | 强烈推荐安装；安装后强制刷新实际就可以卸载了。                            |
| `force-download.user.js`     | 让预览PDF组件显示通常被隐藏的下载等按钮。（需要先点开文件）                                        | 开启则表示你愿意为所有下载行为负责，并且已经解除了下列开发者对你下载行为的责任。           |
| `search-menu.user.js`        | 添加搜索按钮，科目内搜索页面标题并自动跳转，支持拼音首字母搜索。                                       | 目前搜索按钮位置和路径重放相同，无法同时使用，后续会改进。                      |
| `del-unused.user.js`         | 自动从 DOM 中移除具有特定类名（tag, time, result2）的元素，都能保持界面整洁。                     |                                                    |
| `fav-path.user.js`           | 为导航路径添加了一个“收藏夹”系统，包括用于保存、查看和删除收藏位置的用户界面。                               | 添加收藏时请确保没有其他同时处于打开状态的目录，否则可能会保存错误的路径。非致命问题，待原作者修复。 |
| `hard-refresh.user.js`       | 添加一个悬浮按钮，用于执行真正的“硬刷新”：登出用户，清除所有网站存储、服务工作线程和 Cookie，然后重新加载页面，并重放刷新前的路径。 | 在Via上未能正确退出登陆，而是只会重新加载当前界面。目前添加了路径重放。              |
| ~~`path-replay.user.js`~~    | ~~记录并重放最近一次的导航路径，允许在登录或刷新后一键恢复到最后访问的位置。~~                              | 已弃用，文件见v1。按钮位置和搜索相同。                               |
| `responsive-sidebar.user.js` | 侧边栏在屏幕宽度改变时自动收起/展开。                                                    | 目前阈值为宽度800px，待定                                    |

# 如何安装
- Via
  1. 下载并安装Via浏览器：https://viayoo.com/
  2. - 打开Via浏览器，访问项目页面，找到需要的脚本文件（`*.user.js`），点击脚本文件中的"Raw"按钮，Via会自动接管安装过程，确认即可完成安装。
     - 或打开需要的脚本页面并复制脚本内容，在Via浏览器设置 -> 脚本 中点击右上角加号选择"添加脚本"，将脚本粘贴进去并确认。
     - 或下载需要的脚本文件，在Via的脚本管理页面中点击右上角加号选择"导入脚本"，找到下载的文件导入并确认。
  3. 安装完成后，在Via的脚本管理页面中查看和管理已安装的脚本。
- Edge
  - 见原版 [README-zh-CN.md#如何安装](/README-zh-CN.md#如何安装)  

# 贡献与反馈
- 本分支在原作者基础上做出适配修改，如有建议或发现问题，欢迎在仓库 Issues 中反馈或提交 PR。
- 若引用本代码或二次发布，请遵循 GPLv3 许可证条款并保留原作者署名与许可证信息。

# （适配/变更记录）
todo:
- [x] 实现分离出搜索功能
- [x] 修复搜索按钮有时不出现
- [x] 更新收藏夹按钮图标
- [ ] 将所有操作按钮移动到页面最左侧并略微减小
- [x] 关于强制刷新和考试成绩不显示的问题：~~等待原作者后续更新~~已实现
- [ ] 上传照片时允许选择直接打开相机或从相册上传：等待原作者更新
- [x] 侧边栏根据屏幕宽度自动收起/展开？~~用ai~~已实现
- [x] 移除未提交的题目上的空“图片”框，放在del-unused中
- [ ] 上方页面导航栏从只能用两侧按键移动改为可滑动：感觉有点难度，先~~求助~~反馈原作者
- [ ] ...
