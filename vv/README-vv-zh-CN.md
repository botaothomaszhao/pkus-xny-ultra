# PKUS XNY Ultra — VV（Via 浏览器适配）版本

本说明为“VV（Version Via）”分支/发行版的说明文档。VV 版本在原作者 c-jeremy 的开源项目基础上进行适配与修改，以便在 Via 浏览器环境下获得更好的兼容性与体验。

# 重要声明与致谢

- 本项目基于 c-jeremy 的开源项目 [PKUS XNY Ultra](https://github.com/c-jeremy/pkus-xny-ultra)，感谢原作者与社区贡献。我（fork并修改后）在此基础上继续开源发布，欢迎大家审阅与改进。
- 许可证：与原项目一致（详见仓库 LICENSE，GPLv3）。

# 功能和特点

（目前）每项功能均为独立脚本，可根据需要选择安装或在脚本管理页面选择是否开启。脚本均基于v1已有功能/v2功能拆分，经测试在Via和安装篡改猴插件的Edge浏览器上可用。

- 主要功能：路径收藏夹、目录搜索、强制下载pdf、硬刷新、移除界面无用元素、自动收起侧边栏......仍在扩充
- Via优点：
    - 极简风、极小空间占用
    - 支持固定工具栏/点击隐藏工具栏，不上下滑动（注：展开任务栏那个按钮可以拖动）
    - 原生支持脚本，无需安装插件
    - 主页、菜单、长按菜单等均可定制
    - 支持工具栏色彩模式：让浏览器工具栏和系统任务栏跟随网页颜色
- 相比原版（主要对比v2）改进：
    - 完全兼容Via（废话）
    - 可自行选择是否要更改ui风格
    - 可自行选择想要使用的脚本
    - 按钮只需要点一次
    - 支持选择相机拍照上传
    - ...
    - 更多具体功能详见脚本列表
- 不足：
    - 多个功能的脚本需要分别安装（太大单一文件不容易排查兼容性问题）
    - 右侧按钮有时遮挡网页内容
    - 代码越来越臃肿（都是ai干的）
    - 见todo list吧...

黑白UI修改无兼容性问题且未计划进行修改，可直接使用v1中`ui.user.js`，不再单独提供。

# 脚本列表

| 文件名                          | 描述                                                          | 注意                                                  |
|------------------------------|-------------------------------------------------------------|-----------------------------------------------------|
| `seamless-login.user.js`     | 无感登录保活。确保成绩显示、自阅等功能总是可用。                                    | 强烈推荐安装                                              |
| `force-download.user.js`     | 让预览PDF组件显示通常被隐藏的下载等按钮。                                      | 需要先打开文件。注意word ppt等也只能下载新能源转换后的pdf文件。开启则表示你愿意为所有下载行为负责，并且已经解除了开发者对你下载行为的责任。    |
| `search-menu.user.js`        | 添加搜索按钮，在科目内搜索页面标题并自动跳转，支持拼音首字母搜索。                           |                                                     |
| `del-unused.user.js`         | 自动删除无用页面元素，包括头部“学科素养”、“考试用时”和未提交时的空图片框。                     |                                                     |
| `fav-path.user.js`           | 为导航路径添加了一个“收藏夹”系统，包括用于保存、查看和删除收藏位置的用户界面。                    | 添加收藏时请确保没有其他同时处于打开状态的目录，否则可能会保存错误的路径，待修复。           |
| `hard-refresh.user.js`       | 添加按钮，单击会刷新页面; 长按2.5s则登出用户，清除所有网站存储，然后重载页面。任何页面重载后都会重放之前的路径。 |                                                     |
| `responsive-sidebar.user.js` | 让侧边栏在屏幕宽度改变时自动收起/展开，并可通过点击最左侧导航条展开。                         | 目前阈值为宽度800px。                                        |
| `image-upload.user.js`       | 在网页实现相机，上传照片时允许选择直接打开相机或从相册上传。                              | 如果浏览器支持capture字段（如Edge），则不推荐使用。完成拍照后可使用新能源自带旋转、裁剪工具。 |

# 如何安装

- Via
    1. 下载并安装Via浏览器：https://viayoo.com/
    2.
        - 打开Via浏览器，访问项目页面，找到需要的脚本文件（`*.user.js`），点击脚本文件中的"Raw"按钮，Via会自动接管安装过程，确认即可完成安装。
        - 或 打开需要的脚本页面并复制脚本内容，在Via浏览器设置 -> 脚本 中点击右上角加号选择"添加脚本"，将脚本粘贴进去并确认。
        - 或 下载需要的脚本文件，在Via的脚本管理页面中点击右上角加号选择"导入脚本"，找到下载的文件导入并确认。
    3. 安装完成后，在Via的脚本管理页面中查看和管理已安装的脚本。
- Edge
    - 见原版 [README-zh-CN.md#如何安装](/README-zh-CN.md#如何安装)

# 贡献与反馈

- 本分支在原作者基础上做出适配修改，如有建议或发现问题，欢迎在仓库 Issues 中反馈或提交 PR。
- 若引用本代码或二次发布，请遵循 GPLv3 许可证条款并保留原作者署名与许可证信息。

# todos:

- [x] 实现分离出搜索功能
- [x] 修复搜索按钮有时不出现
- [x] 更新收藏夹按钮图标
- [x] 关于强制刷新和考试成绩不显示的问题：~~等待原作者后续更新~~已实现
- [x] 上传照片时允许选择直接打开相机或从相册上传
- [x] 打开相机后拦截回退
- [x] ~~相机对焦、缩放功能？~~ 不好实现且无必要
- [x] 侧边栏根据屏幕宽度自动收起/展开？~~用ai~~已实现
- [x] 移除未提交的题目上的空“图片”框，放在del-unused中
- [x] 优化删除元素脚本
- [x] 刷新路径提前自动保存；尝试在登出重进后仍能重放路径
- [x] 尝试修复强制刷新按钮自己乱转问题
- [x] 在点击左侧导航栏时展开侧边栏
- [x] ~~添加收藏夹按钮不变小~~ 经测试无法解决
- [x] 同时支持强制刷新和仅页面刷新
- [x] 修复Via上强制刷新无法登出的问题
- [ ] 合并4个按钮的插件
- [ ] 彻底修复保存路径bug
    - [ ] 修复回放路径遇到已打开文件夹时失败的问题
    - [ ] 尝试在开始回放时打断正在进行的回放，避免冲突
- [ ] 在播放路径后更新最新路径（以供刷新时）
- [ ] 将所有操作按钮移动到页面最左侧并略微减小
- [ ] 添加快捷键功能（希望获得反馈：用哪些键）
- [ ] 在登录界面隐藏按钮
- [ ] 在上传照片确认、查看图片、查看解析等页面将按钮置于下层
- [ ] 添加ESC关闭收藏夹/搜索框等的功能

- 远期：
- [ ] 上方页面导航栏从只能用两侧按键移动改为可滑动：感觉有点难度，先~~求助~~反馈原作者
- [ ] 修复提交照片后只显示第一张预览（估计比较困难，仅作为可能改进方向）
- [ ] pdf预览框添加和查看答案一样的全屏键
- [ ] ...
